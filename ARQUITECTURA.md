# ğŸ—ï¸ ARQUITECTURA DEL SISTEMA

## DIAGRAMA DE FLUJO PRINCIPAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                         â”‚
â”‚                    http://localhost:5173                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTP Requests (JSON)
                      â”‚ Authorization: Bearer <JWT>
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXPRESS SERVER (Node.js)                      â”‚
â”‚                    http://localhost:5000                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MIDDLEWARE STACK                                          â”‚ â”‚
â”‚  â”‚  â€¢ Helmet (Security Headers)                               â”‚ â”‚
â”‚  â”‚  â€¢ CORS (Cross-Origin)                                     â”‚ â”‚
â”‚  â”‚  â€¢ Rate Limiting                                           â”‚ â”‚
â”‚  â”‚  â€¢ Body Parser (JSON)                                      â”‚ â”‚
â”‚  â”‚  â€¢ Morgan (HTTP Logger)                                    â”‚ â”‚
â”‚  â”‚  â€¢ JWT Verification (Auth)                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ROUTES & CONTROLLERS                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   Auth   â”‚  â”‚ Persons  â”‚  â”‚Programs  â”‚  â”‚ Letters  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SERVICES (Business Logic)                                 â”‚ â”‚
â”‚  â”‚  â€¢ Algorithm Service (â­ Core - AsignaciÃ³n)                â”‚ â”‚
â”‚  â”‚  â€¢ PDF Service (Puppeteer)                                 â”‚ â”‚
â”‚  â”‚  â€¢ Validation & Processing                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MONGOOSE ODM                                              â”‚ â”‚
â”‚  â”‚  â€¢ Schemas & Validations                                   â”‚ â”‚
â”‚  â”‚  â€¢ Methods & Hooks                                         â”‚ â”‚
â”‚  â”‚  â€¢ Query Building                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ MongoDB Wire Protocol
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONGODB DATABASE                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ churches  â”‚  â”‚   users   â”‚  â”‚  persons  â”‚  â”‚   roles   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚activity   â”‚  â”‚ programs  â”‚  â”‚ letter    â”‚  â”‚generated  â”‚   â”‚
â”‚  â”‚  Types    â”‚  â”‚(embedded) â”‚  â”‚ templates â”‚  â”‚  letters  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## FLUJO DE GENERACIÃ“N DE PROGRAMA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USUARIO SOLICITA GENERAR PROGRAMA                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ POST /api/v1/programs/generate
                â”‚ Body: { activityTypeId, programDate, options }
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. CONTROLLER â†’ Valida datos y llama al servicio                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ALGORITHM SERVICE - â­ CORAZÃ“N DEL SISTEMA                    â”‚
â”‚                                                                   â”‚
â”‚  A) Obtener configuraciÃ³n de ActivityType                        â”‚
â”‚     â€¢ QuÃ© roles se necesitan                                     â”‚
â”‚     â€¢ CuÃ¡ntas personas por rol                                   â”‚
â”‚                                                                   â”‚
â”‚  B) Obtener personas disponibles                                 â”‚
â”‚     â€¢ Status = ACTIVE                                            â”‚
â”‚     â€¢ No en unavailability en esa fecha                          â”‚
â”‚     â€¢ Tienen el rol requerido                                    â”‚
â”‚                                                                   â”‚
â”‚  C) Calcular historial de participaciones (Ãºltimas 4 semanas)    â”‚
â”‚     â€¢ Aggregation pipeline en MongoDB                            â”‚
â”‚     â€¢ Por persona y por rol                                      â”‚
â”‚                                                                   â”‚
â”‚  D) SCORING de cada candidato                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ SCORE = 100 (base)                               â”‚        â”‚
â”‚     â”‚                                                   â”‚        â”‚
â”‚     â”‚ BONUS:                                            â”‚        â”‚
â”‚     â”‚ + 30 si status = NEW                             â”‚        â”‚
â”‚     â”‚ + 20 si status = LEADER                          â”‚        â”‚
â”‚     â”‚ + priority * 10                                  â”‚        â”‚
â”‚     â”‚                                                   â”‚        â”‚
â”‚     â”‚ PENALTIES:                                        â”‚        â”‚
â”‚     â”‚ - 50 si participÃ³ mismo rol hace â‰¤2 semanas      â”‚        â”‚
â”‚     â”‚ - 30 si participÃ³ mismo rol hace â‰¤4 semanas      â”‚        â”‚
â”‚     â”‚ - 20 si participÃ³ cualquier rol la semana pasada â”‚        â”‚
â”‚     â”‚ - 10 si participÃ³ hace 2 semanas                 â”‚        â”‚
â”‚     â”‚ - 5 * total_participaciones_recientes            â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                   â”‚
â”‚  E) Seleccionar TOP candidatos por score                         â”‚
â”‚     â€¢ Si peopleNeeded = 3 â†’ tomar top 3                          â”‚
â”‚                                                                   â”‚
â”‚  F) Crear asignaciones (assignments)                             â”‚
â”‚     â€¢ person + role + section                                    â”‚
â”‚     â€¢ isManual = false                                           â”‚
â”‚                                                                   â”‚
â”‚  G) Validar alertas                                              â”‚
â”‚     â€¢ Â¿Faltan personas?                                          â”‚
â”‚     â€¢ Â¿Roles sin cubrir?                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. GUARDAR EN MONGODB                                            â”‚
â”‚    â€¢ Crear documento Program                                     â”‚
â”‚    â€¢ Con assignments embebidos                                   â”‚
â”‚    â€¢ Status = DRAFT                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. RESPONDER AL FRONTEND                                         â”‚
â”‚    â€¢ Programa generado con todas las asignaciones                â”‚
â”‚    â€¢ Alertas si las hay                                          â”‚
â”‚    â€¢ Usuario puede ajustar manualmente                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ESTRUCTURA DE DATOS EN MONGODB

### Program Document (Ejemplo)

```json
{
  "_id": "65a1b2c3d4e5f6g7h8i9j0",
  "churchId": "church_123",
  "activityType": {
    "id": "activity_456",
    "name": "AdoraciÃ³n"
  },
  "programDate": "2026-03-15T00:00:00.000Z",
  "status": "PUBLISHED",
  "assignments": [
    {
      "_id": "assign_1",
      "sectionName": "Apertura",
      "sectionOrder": 1,
      "roleName": "OraciÃ³n",
      "person": {
        "id": "person_789",
        "name": "MarÃ­a GonzÃ¡lez",
        "phone": "+1-809-555-1234"
      },
      "isManual": false,
      "assignedAt": "2026-03-01T10:30:00.000Z"
    },
    {
      "_id": "assign_2",
      "sectionName": "Alabanza",
      "sectionOrder": 2,
      "roleName": "MÃºsico",
      "person": {
        "id": "person_012",
        "name": "Pedro MartÃ­nez",
        "phone": "+1-809-555-5678"
      },
      "isManual": false,
      "assignedAt": "2026-03-01T10:30:00.000Z"
    }
    // ... mÃ¡s asignaciones
  ],
  "pdfUrl": "https://cloudinary.com/.../program_123.pdf",
  "notes": null,
  "generatedBy": {
    "id": "user_345",
    "name": "Admin Usuario"
  },
  "generatedAt": "2026-03-01T10:30:00.000Z",
  "createdAt": "2026-03-01T10:30:00.000Z",
  "updatedAt": "2026-03-02T14:20:00.000Z"
}
```

---

## ÃNDICES DE MONGODB (OptimizaciÃ³n)

```javascript
// programs collection
programs.createIndex({ churchId: 1, programDate: -1 })
programs.createIndex({ churchId: 1, 'activityType.id': 1, programDate: -1 })
programs.createIndex({ 'assignments.person.id': 1, programDate: -1 })

// persons collection
persons.createIndex({ churchId: 1, status: 1 })
persons.createIndex({ churchId: 1, fullName: 1 })
persons.createIndex({ 'roles.roleId': 1 })

// Query example (super rÃ¡pido con Ã­ndices):
db.programs.find({
  churchId: ObjectId("..."),
  programDate: { $gte: ISODate("2026-02-01") }
}).sort({ programDate: -1 })
```

---

## VENTAJAS DE MONGODB PARA ESTE PROYECTO

### âœ… Embeddings
- Asignaciones embebidas en Program = **1 query** (vs mÃºltiples JOINs)
- roleConfig embebido en ActivityType = no necesita tabla separada

### âœ… Flexibilidad
- Cada iglesia puede agregar campos custom sin migraciones
- Subdocumentos dinÃ¡micos (unavailability, roles)

### âœ… Aggregation Pipeline
```javascript
// Obtener top 10 participantes en Ãºltimas 4 semanas
db.programs.aggregate([
  { $match: { programDate: { $gte: fourWeeksAgo } } },
  { $unwind: "$assignments" },
  { $group: {
      _id: "$assignments.person.id",
      name: { $first: "$assignments.person.name" },
      count: { $sum: 1 }
  }},
  { $sort: { count: -1 } },
  { $limit: 10 }
])
// Super eficiente con Ã­ndices correctos
```

### âœ… Escalabilidad
- Sharding por `churchId` cuando crezca
- RÃ©plicas para alta disponibilidad

---

## ğŸ¯ PRÃ“XIMO PASO: ALGORITMO

El corazÃ³n del sistema es el **Algorithm Service**. SerÃ¡ implementado como:

```
backend/src/modules/programs/algorithm.service.ts
```

Este archivo contendrÃ¡ toda la lÃ³gica de:
- Scoring de fairness
- SelecciÃ³n de candidatos
- Manejo de casos borde
- Alertas y sugerencias

**Â¿Listo para implementarlo?** ğŸš€
